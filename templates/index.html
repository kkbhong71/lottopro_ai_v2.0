<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LottoPro AI {{ version or 'v2.0' }} - AI 로또 번호 예측</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .hero-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
            padding: 3rem;
        }
        
        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .btn-primary {
            background: #3498db;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }
        
        .number-ball {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #3498db, #2c3e50);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            margin: 2px;
        }
        
        .prediction-result {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner-border {
            color: #3498db;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #27ae60;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .navbar {
            backdrop-filter: blur(10px);
        }
        
        .alert-warning {
            border-left: 4px solid #f39c12;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: rgba(0,0,0,0.1);">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">
                <i class="fas fa-magic me-2"></i>
                LottoPro AI {{ version or 'v2.0' }}
            </a>
            <div class="ms-auto">
                <span class="badge bg-success">
                    <span class="status-indicator"></span>
                    온라인
                </span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section text-center">
            <h1 class="display-4 fw-bold mb-4" style="color: #2c3e50;">
                <i class="fas fa-brain me-3"></i>
                AI 기반 로또 번호 분석 시스템
            </h1>
            <p class="lead mb-4" style="color: #34495e;">
                투명한 알고리즘과 검증된 통계 분석으로 최적의 번호 조합을 제공합니다
            </p>
            
            <!-- 법적 고지사항 -->
            <div class="alert alert-warning mb-4">
                <div class="d-flex align-items-start">
                    <i class="fas fa-exclamation-triangle me-2 mt-1"></i>
                    <div>
                        <strong>중요 고지:</strong> 본 서비스는 오락 목적이며, 로또 당첨을 보장하지 않습니다. 
                        로또는 순수한 확률게임으로 AI 예측 역시 참고용일 뿐입니다.
                        <br><strong>만 19세 이상만 이용 가능하며, 책임감 있는 구매를 권장합니다.</strong>
                    </div>
                </div>
            </div>
            
            <!-- Status Indicators -->
            <div class="row text-center mb-4">
                <div class="col-md-3">
                    <div class="feature-card">
                        <span class="status-indicator"></span>
                        <strong>시스템 상태</strong><br>
                        <small class="text-success">정상 운영</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card">
                        <i class="fas fa-database text-primary me-2"></i>
                        <strong>분석 회차</strong><br>
                        <small>{{ analysis_round or '1186' }}회차</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card">
                        <i class="fas fa-calendar text-warning me-2"></i>
                        <strong>업데이트</strong><br>
                        <small>{{ update_date or '2025.08.28' }}</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card">
                        <i class="fas fa-chart-line text-success me-2"></i>
                        <strong>AI 모델</strong><br>
                        <small>5개 모델 운영</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI 예측 섹션 -->
        <div class="hero-section">
            <h2 class="text-center mb-4">
                <i class="fas fa-magic me-2"></i>
                AI 예상번호 생성
            </h2>
            
            <!-- 사용자 입력 -->
            <div class="row justify-content-center mb-4">
                <div class="col-lg-8">
                    <div class="card border-0 shadow">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-heart me-2"></i>선호하는 번호 입력 (선택사항)
                            </h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-3">
                                생일, 기념일 등 원하는 번호가 있다면 입력하세요. AI가 나머지를 추천해드립니다.
                            </p>
                            <div class="row g-2 mb-3">
                                <div class="col-2">
                                    <input type="number" class="form-control text-center" placeholder="1" min="1" max="45" id="num1">
                                </div>
                                <div class="col-2">
                                    <input type="number" class="form-control text-center" placeholder="2" min="1" max="45" id="num2">
                                </div>
                                <div class="col-2">
                                    <input type="number" class="form-control text-center" placeholder="3" min="1" max="45" id="num3">
                                </div>
                                <div class="col-2">
                                    <input type="number" class="form-control text-center" placeholder="4" min="1" max="45" id="num4">
                                </div>
                                <div class="col-2">
                                    <input type="number" class="form-control text-center" placeholder="5" min="1" max="45" id="num5">
                                </div>
                                <div class="col-2">
                                    <input type="number" class="form-control text-center" placeholder="6" min="1" max="45" id="num6">
                                </div>
                            </div>
                            <div class="text-center">
                                <button class="btn btn-primary btn-lg" onclick="generatePrediction()">
                                    <i class="fas fa-magic me-2"></i>
                                    AI 예상번호 생성하기
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 로딩 -->
            <div id="loading" class="loading">
                <div class="spinner-border mb-3" role="status"></div>
                <h4>AI 모델이 데이터를 분석하고 있습니다...</h4>
                <p class="text-muted">잠시만 기다려주세요. 최적의 번호를 찾고 있어요!</p>
            </div>
            
            <!-- 결과 -->
            <div id="results" style="display: none;">
                <!-- TOP 추천 -->
                <div class="card border-0 shadow mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-crown me-2"></i>AI 최고 추천 번호 TOP 5
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="top-recommendations">
                            <!-- 동적으로 생성될 내용 -->
                        </div>
                    </div>
                </div>
                
                <!-- 모델별 결과 -->
                <div class="card border-0 shadow">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-robot me-2"></i>모델별 상세 분석 결과
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="model-results">
                            <!-- 동적으로 생성될 내용 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 시스템 상태 확인 -->
        <div class="text-center mb-4">
            <button class="btn btn-outline-secondary" onclick="checkHealth()">
                <i class="fas fa-heartbeat me-2"></i>
                시스템 상태 확인
            </button>
        </div>
        
        <!-- 상태 결과 -->
        <div id="health-results" style="display: none;" class="hero-section">
            <!-- 상태 정보가 여기에 표시됩니다 -->
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4 mt-5" style="background: rgba(0,0,0,0.1); color: white;">
        <div class="container">
            <p class="mb-2">
                <strong>LottoPro AI {{ version or 'v2.0' }}</strong> - AI 기반 로또 예측 서비스
            </p>
            <p class="mb-0 small">
                <i class="fas fa-exclamation-triangle me-1"></i>
                과도한 도박은 중독을 유발할 수 있습니다. 19세 미만 이용 금지.
            </p>
            <p class="mb-0 small">
                © {{ copyright_year or '2025' }} LottoPro AI. 모든 예측은 통계적 분석이며 당첨을 보장하지 않습니다.
            </p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // AI 예측 생성 함수
        async function generatePrediction() {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            // 사용자 입력 수집
            const userNumbers = [];
            for (let i = 1; i <= 6; i++) {
                const input = document.getElementById(`num${i}`);
                const value = parseInt(input.value);
                if (value && value >= 1 && value <= 45) {
                    userNumbers.push(value);
                }
            }
            
            // 중복 검사
            const uniqueNumbers = [...new Set(userNumbers)];
            if (uniqueNumbers.length !== userNumbers.length) {
                alert('중복된 번호가 있습니다. 서로 다른 번호를 입력해주세요.');
                return;
            }
            
            // 로딩 표시
            loading.style.display = 'block';
            results.style.display = 'none';
            
            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_numbers: uniqueNumbers
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayResults(data);
                } else {
                    throw new Error(data.error || '예측 생성에 실패했습니다.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('예측 생성 중 오류가 발생했습니다: ' + error.message);
            } finally {
                loading.style.display = 'none';
            }
        }
        
        // 결과 표시 함수
        function displayResults(data) {
            const results = document.getElementById('results');
            const topRecommendations = document.getElementById('top-recommendations');
            const modelResults = document.getElementById('model-results');
            
            // TOP 추천 표시
            let topHtml = '';
            if (data.top_recommendations && data.top_recommendations.length > 0) {
                data.top_recommendations.slice(0, 5).forEach((numbers, index) => {
                    topHtml += `
                        <div class="prediction-result">
                            <h6 class="fw-bold">추천 ${index + 1}</h6>
                            <div class="mb-2">
                                ${numbers.map(num => `<span class="number-ball">${num}</span>`).join('')}
                            </div>
                        </div>
                    `;
                });
            }
            topRecommendations.innerHTML = topHtml || '<p class="text-muted">추천 번호를 생성하지 못했습니다.</p>';
            
            // 모델별 결과 표시
            let modelHtml = '';
            if (data.models) {
                Object.entries(data.models).forEach(([modelName, modelData]) => {
                    modelHtml += `
                        <div class="prediction-result">
                            <h6 class="fw-bold text-primary">
                                <i class="fas fa-robot me-2"></i>${modelName}
                                <span class="badge bg-secondary ms-2">${modelData.accuracy}% 정확도</span>
                            </h6>
                            <p class="text-muted small">${modelData.description}</p>
                            ${modelData.predictions && modelData.predictions[0] ? 
                                `<div class="mb-2">
                                    ${modelData.predictions[0].map(num => `<span class="number-ball">${num}</span>`).join('')}
                                </div>` : ''
                            }
                        </div>
                    `;
                });
            }
            modelResults.innerHTML = modelHtml || '<p class="text-muted">모델 결과를 표시할 수 없습니다.</p>';
            
            // 결과 섹션 표시
            results.style.display = 'block';
            
            // 결과 섹션으로 스크롤
            results.scrollIntoView({ behavior: 'smooth' });
        }
        
        // 시스템 상태 확인 함수
        async function checkHealth() {
            const healthResults = document.getElementById('health-results');
            
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                let statusHtml = `
                    <h3 class="text-center mb-4">
                        <i class="fas fa-heartbeat me-2"></i>
                        시스템 상태
                    </h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-0 shadow">
                                <div class="card-body text-center">
                                    <i class="fas fa-server fa-2x text-primary mb-2"></i>
                                    <h6>서비스 상태</h6>
                                    <span class="badge ${data.status === 'healthy' ? 'bg-success' : 'bg-danger'}">${data.status}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 shadow">
                                <div class="card-body text-center">
                                    <i class="fas fa-database fa-2x text-info mb-2"></i>
                                    <h6>데이터 상태</h6>
                                    <small>${data.sample_data_count || 0}회차 분석 준비</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                if (data.pandas_available !== undefined || data.ml_available !== undefined) {
                    statusHtml += `
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <div class="card border-0 shadow">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chart-line fa-2x ${data.pandas_available ? 'text-success' : 'text-warning'} mb-2"></i>
                                        <h6>데이터 분석</h6>
                                        <span class="badge ${data.pandas_available ? 'bg-success' : 'bg-warning'}">
                                            ${data.pandas_available ? '사용 가능' : '기본 모드'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-0 shadow">
                                    <div class="card-body text-center">
                                        <i class="fas fa-brain fa-2x ${data.ml_available ? 'text-success' : 'text-warning'} mb-2"></i>
                                        <h6>머신러닝</h6>
                                        <span class="badge ${data.ml_available ? 'bg-success' : 'bg-warning'}">
                                            ${data.ml_available ? '사용 가능' : '기본 모드'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-0 shadow">
                                    <div class="card-body text-center">
                                        <i class="fas fa-qrcode fa-2x ${data.qr_available ? 'text-success' : 'text-warning'} mb-2"></i>
                                        <h6>QR 스캔</h6>
                                        <span class="badge ${data.qr_available ? 'bg-success' : 'bg-warning'}">
                                            ${data.qr_available ? '사용 가능' : '준비 중'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                healthResults.innerHTML = statusHtml;
                healthResults.style.display = 'block';
                
                // 상태 섹션으로 스크롤
                healthResults.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Health check failed:', error);
                healthResults.innerHTML = `
                    <h3 class="text-center mb-4 text-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        연결 오류
                    </h3>
                    <p class="text-center text-muted">서버 상태를 확인할 수 없습니다.</p>
                `;
                healthResults.style.display = 'block';
            }
        }
        
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('LottoPro AI v2.0 초기화 완료');
            
            // Enter 키 지원
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach((input, index) => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        if (index < inputs.length - 1) {
                            inputs[index + 1].focus();
                        } else {
                            generatePrediction();
                        }
                    }
                });
                
                // 입력 검증
                input.addEventListener('input', function(e) {
                    const value = parseInt(e.target.value);
                    if (value < 1 || value > 45) {
                        e.target.setCustomValidity('1-45 사이의 번호를 입력해주세요.');
                    } else {
                        e.target.setCustomValidity('');
                    }
                });
            });
        });
    </script>
</body>
</html>
